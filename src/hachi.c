#include "hachi.h"
#include "ncur_layer.h"
#include "x11_layer.h"

char FONT_TABLE[16*5] = {
0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
0x20, 0x60, 0x20, 0x20, 0x70, // 1
0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
0x90, 0x90, 0xF0, 0x10, 0x10, // 4
0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
0xF0, 0x10, 0x20, 0x40, 0x40, // 7
0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
0xF0, 0x90, 0xF0, 0x90, 0x90, // A
0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
0xF0, 0x80, 0x80, 0x80, 0xF0, // C
0xE0, 0x90, 0x90, 0x90, 0xE0, // D
0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

hachiChip  Hachi = {0};

void setuphachi()
{
    // Copy Font data from FONT_TABLE to Hachi MEM

    int FontStAdr = 0x50;
    int FontEnAdr = 0x9F;
    int c = 0;

    for (int i=FontStAdr; i <= FontEnAdr; ++i) {
        Hachi.mem[i] = FONT_TABLE[c];
        ++c;
    }

    switch (Hachi.backend) {
        case NCUR: ncur_setupkeys();
                   break;
        case X11_GL: x11_setupkeys();
                   break;

        case BACKEND_COUNT: break;
    }
}

short int fetchIns()
{
    short int ins = 0 | (Hachi.mem[Hachi.pc++] << 8) | (Hachi.mem[Hachi.pc++]);
    return ins;
}
